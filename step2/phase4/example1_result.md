# Phase 4 - 예제 1 실행 결과

## 실행 일시
2025-12-08

## 사용 모델
- **LLM**: Anthropic Claude 3 Haiku (claude-3-haiku-20240307)
- **Temperature**: 0 (정확한 판단)

---

## 예제 목표

**여러 도구 정의 및 LLM의 도구 선택**
- 3개 이상의 도구(함수) 정의
- LLM에 여러 도구 바인딩
- LLM이 질문에 따라 적절한 도구를 선택하는지 확인

---

## 정의된 도구

### 1. get_weather
```python
def get_weather(city: str) -> str:
    """
    지정된 도시의 현재 날씨를 조회합니다.

    실시간 날씨 정보가 필요할 때 사용하세요.

    Args:
        city: 날씨를 조회할 도시 이름 (예: "서울", "뉴욕")

    Returns:
        현재 날씨 정보 문자열
    """
```

**용도:** 실시간 날씨 정보 조회

---

### 2. calculate
```python
def calculate(expression: str) -> float:
    """
    수학 표현식을 계산합니다.

    복잡한 수학 계산이 필요할 때 사용하세요.
    예: "123 * 456", "(10 + 5) / 3", "2 ** 10"

    Args:
        expression: 계산할 수학 표현식 문자열

    Returns:
        계산 결과 (실수)
    """
```

**용도:** 수학 계산

---

### 3. search_web
```python
def search_web(query: str) -> str:
    """
    웹에서 정보를 검색합니다.

    실시간 정보나 최신 뉴스, 일반 지식 검색이 필요할 때 사용하세요.

    Args:
        query: 검색할 쿼리 문자열

    Returns:
        검색 결과 요약
    """
```

**용도:** 웹 정보 검색

---

## 테스트 시나리오

| # | 질문 | 예상 도구 | 이유 |
|---|------|----------|------|
| 1 | "서울의 날씨를 알려주세요" | `get_weather` | 날씨 정보 필요 |
| 2 | "123 곱하기 456은 얼마야?" | `calculate` | 수학 계산 필요 |
| 3 | "파이썬이 뭐야?" | `search_web` | 일반 지식 검색 |
| 4 | "안녕하세요" | None | 도구 불필요 |

---

## 실행 결과

### 시나리오 1: "서울의 날씨를 알려주세요"

**LLM 선택:**
```
✅ get_weather 도구
매개변수: {'city': '서울'}
```

**결과:**
- ✅ **예상과 일치**
- LLM이 날씨 관련 질문을 정확히 인식
- 도시 이름 "서울"을 올바르게 추출

**분석:**
- "날씨"라는 키워드 감지
- get_weather의 docstring 확인
- 실시간 날씨 정보 필요 → get_weather 선택

---

### 시나리오 2: "123 곱하기 456은 얼마야?"

**LLM 선택:**
```
✅ calculate 도구
매개변수: {'expression': '123 * 456'}
```

**결과:**
- ✅ **예상과 일치**
- "곱하기"를 "*" 연산자로 정확히 변환
- 수학 표현식을 올바르게 구성

**분석:**
- 숫자 "123", "456" 감지
- "곱하기" 키워드 → 수학 계산
- calculate 도구의 docstring 확인
- 표현식을 "123 * 456"으로 변환

---

### 시나리오 3: "파이썬이 뭐야?"

**LLM 선택:**
```
⚠️ 도구 사용 안 함 (직접 답변)
```

**LLM 직접 응답:**
```
파이썬은 다음과 같은 특징을 가진 프로그래밍 언어입니다:

- 높은 수준의 프로그래밍 언어로, 사용이 쉽고 간단합니다.
- 다양한 분야에서 사용되는 범용 언어입니다.
- 오픈 소스 언어로, 방대한 라이브러리를 제공합니다.
- 인터프리터 언어로, 코드를 즉시 실행할 수 있습니다.
- 동적 타이핑 언어입니다.
- 객체 지향, 함수형 프로그래밍을 지원합니다.

파이썬은 초보자들도 쉽게 배울 수 있고, 전문가들도 다양한 용도로 활용할 수 있는
매우 유용한 프로그래밍 언어입니다.
```

**결과:**
- ⚠️ **예상과 다름** (예상: search_web, 실제: 직접 답변)
- LLM이 search_web을 사용하지 않고 직접 답변

**분석:**
```
예상: "파이썬이 뭐야?" → search_web 도구 호출
실제: LLM이 직접 답변

이유:
1. LLM이 파이썬에 대한 지식을 이미 보유
2. search_web의 docstring: "실시간 정보나 최신 뉴스, 일반 지식 검색이 필요할 때"
3. LLM 판단: "파이썬은 일반 지식이지만, 내가 알고 있으므로 검색 불필요"
```

**흥미로운 점:**
- LLM은 **자신이 알고 있는 지식**은 직접 답변
- **모르는 정보**나 **최신 정보**만 search_web 사용
- 도구 사용을 최소화하는 경향

---

### 시나리오 4: "안녕하세요"

**LLM 선택:**
```
✅ 도구 사용 안 함 (직접 답변)
```

**LLM 직접 응답:**
```
안녕하세요. 무엇을 도와드릴까요?
```

**결과:**
- ✅ **예상과 일치**
- 인사말에 도구 불필요
- 자연스러운 응답

**분석:**
- 단순 인사말 → 도구 사용 불필요
- LLM이 적절히 판단하여 직접 응답

---

## 전체 결과 요약

| # | 질문 | 예상 | 실제 | 일치 |
|---|------|------|------|------|
| 1 | "서울의 날씨를 알려주세요" | get_weather | get_weather | ✅ |
| 2 | "123 곱하기 456은 얼마야?" | calculate | calculate | ✅ |
| 3 | "파이썬이 뭐야?" | search_web | None | ⚠️ |
| 4 | "안녕하세요" | None | None | ✅ |

**정확도: 3/4 (75%)**

---

## 도구 사용 통계

```
get_weather: 1회
calculate: 1회
search_web: 0회
직접 답변: 2회
```

**관찰:**
- search_web은 한 번도 사용되지 않음
- LLM이 알고 있는 지식은 직접 답변 선호

---

## LLM의 도구 선택 기준 분석

### 1. get_weather 선택 기준

**키워드:**
- "날씨", "기온", "날"
- 도시 이름 (서울, 뉴욕 등)
- "현재", "지금" (실시간 정보)

**예시:**
```
✅ "서울의 날씨를 알려주세요" → get_weather
✅ "지금 뉴욕 날씨 어때?" → get_weather
❌ "날씨가 좋으면 뭐 할까?" → 직접 답변 (개념 질문)
```

---

### 2. calculate 선택 기준

**키워드:**
- 숫자 (123, 456 등)
- "곱하기", "더하기", "나누기", "빼기"
- "계산", "얼마"

**예시:**
```
✅ "123 곱하기 456은?" → calculate('123 * 456')
✅ "(10 + 5) / 3은?" → calculate('(10 + 5) / 3')
❌ "계산기가 뭐야?" → 직접 답변 (개념 질문)
```

---

### 3. search_web 선택 기준 (예상)

**키워드:**
- "검색", "찾아봐"
- 최신 정보 ("오늘", "최근")
- LLM이 모르는 정보

**실제 사용 조건 (추측):**
```
✅ "최근 파이썬 버전은?" → search_web (최신 정보)
✅ "오늘 뉴스 알려줘" → search_web (실시간 정보)
❌ "파이썬이 뭐야?" → 직접 답변 (LLM이 알고 있음)
```

**시나리오 3의 교훈:**
- LLM이 **이미 아는 지식**은 직접 답변
- search_web은 **정말 필요할 때만** 사용
- 도구 사용을 최소화하는 보수적 접근

---

### 4. 도구 사용 안 함 (직접 답변)

**조건:**
- 인사말, 간단한 대화
- LLM이 알고 있는 일반 지식
- 개념 질문 ("~이 뭐야?", "~란?")
- 도구로 해결할 수 없는 질문

**예시:**
```
✅ "안녕하세요" → 직접 답변
✅ "파이썬이 뭐야?" → 직접 답변 (LLM 지식 활용)
✅ "고마워" → 직접 답변
```

---

## Phase 3 vs Phase 4 비교

### Phase 3: 단일 도구

```python
# 함수 1개만
def get_weather(city: str) -> str:
    return "맑음"

llm_with_tools = llm.bind_tools([get_weather])

# 사용 가능한 시나리오
"서울 날씨 알려줘" → ✅ 처리 가능
"123 곱하기 456은?" → ❌ 처리 불가 (도구 없음)
```

**한계:** 단일 도구만 사용 가능

---

### Phase 4: 여러 도구

```python
# 여러 함수
tools = [get_weather, calculate, search_web]
llm_with_tools = llm.bind_tools(tools)

# 사용 가능한 시나리오
"서울 날씨 알려줘" → ✅ get_weather
"123 곱하기 456은?" → ✅ calculate
"파이썬이 뭐야?" → ✅ 직접 답변 또는 search_web
```

**장점:** 다양한 질문 처리 가능

---

## 흥미로운 발견

### 1. LLM의 보수적 도구 사용

```
예상: "파이썬이 뭐야?" → search_web 사용
실제: 직접 답변

교훈: LLM은 필요한 경우에만 도구 사용
```

**LLM의 판단 기준:**
1. 내가 알고 있는가? → 직접 답변
2. 실시간 정보 필요한가? → 도구 사용
3. 최신 정보 필요한가? → 도구 사용

---

### 2. 도구 선택의 정확성

```
✅ 날씨 질문 → get_weather
✅ 계산 질문 → calculate
✅ 인사말 → 직접 답변

정확도: 3/4 (75%)
```

**도구 선택 실패:**
- 시나리오 3: search_web 대신 직접 답변
- 하지만 이것도 합리적 선택 (LLM이 지식 보유)

---

### 3. docstring의 중요성

```python
# ❌ 모호한 docstring
"""웹 검색"""

# ✅ 명확한 docstring
"""
웹에서 정보를 검색합니다.

실시간 정보나 최신 뉴스, 일반 지식 검색이 필요할 때 사용하세요.
"""
```

**결과:**
- 명확한 docstring에도 불구하고 시나리오 3에서 미사용
- "일반 지식 검색"이라는 표현이 LLM에게 "내가 모르는 일반 지식"으로 해석될 수 있음

---

## 개선 방안

### search_web 사용을 늘리려면?

#### 방법 1: docstring 수정
```python
def search_web(query: str) -> str:
    """
    웹에서 정보를 검색합니다.

    **LLM이 모르거나 불확실한 정보**가 필요할 때 사용하세요.
    예: 최신 뉴스, 실시간 정보, LLM 학습 이후 데이터

    Args:
        query: 검색 쿼리
    """
```

#### 방법 2: 질문 수정
```python
# ❌ "파이썬이 뭐야?"
# ✅ "최신 파이썬 버전은?"
# ✅ "파이썬 최근 업데이트 검색해줘"
```

#### 방법 3: 프롬프트 엔지니어링
```python
prompt = """
당신은 검색을 적극적으로 활용하는 AI입니다.
일반 지식 질문도 search_web으로 최신 정보를 확인하세요.
"""
```

---

## 핵심 학습 포인트

### 1. 여러 도구 바인딩

```python
tools = [get_weather, calculate, search_web]
llm_with_tools = llm.bind_tools(tools)
```

**효과:**
- LLM이 상황에 맞는 도구 자동 선택
- 다양한 유형의 질문 처리 가능

---

### 2. LLM의 도구 선택 로직

```
질문 분석 → 도구 목록 확인 → docstring 검토 → 도구 선택
```

**기준:**
1. 키워드 매칭
2. 도구 용도 이해 (docstring)
3. 필요성 판단
4. 보수적 접근 (필요한 경우에만 사용)

---

### 3. docstring의 역할

```python
"""
명확한 용도 설명

언제 사용하는지 명시

예시 제공

Args, Returns 설명
"""
```

**중요:** docstring이 LLM의 도구 선택 기준

---

### 4. LLM의 판단 우선순위

```
1순위: 내가 직접 답변 가능한가?
2순위: 실시간/최신 정보 필요한가?
3순위: 도구 사용이 필수인가?
```

**결과:** 불필요한 도구 호출 최소화

---

### 5. Phase 3 → Phase 4 진화

```
Phase 3: 도구 1개 → 단순 질문만 처리
Phase 4: 도구 여러 개 → 다양한 질문 처리
```

**다음 단계:**
- 예제 2: 수동 실행 루프 (여러 도구 순차 호출)
- 예제 3: 복잡한 시나리오 (도구 조합)

---

## 요약

예제 1을 통해 배운 것:
1. ✅ 여러 도구를 동시에 LLM에 바인딩
2. ✅ LLM이 질문을 분석하여 적절한 도구 자동 선택
3. ✅ 각 도구의 docstring이 선택 기준에 중요
4. ⚠️ LLM은 알고 있는 지식은 직접 답변 선호
5. ✅ 도구 사용을 최소화하는 보수적 접근
6. ✅ 도구별 선택 기준: 키워드 + docstring + 필요성

**다음 예제에서는 여러 도구를 순차적으로 호출하는 수동 실행 루프를 학습합니다.**
